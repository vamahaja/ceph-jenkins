jenkins:
  systemMessage: "Ceph Jenkins Controller"
  numExecutors: 0
  mode: EXCLUSIVE

  # Security configuration
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: "admin"

  # Authorization configuration
  authorizationStrategy:
    globalMatrix:
      entries:
        - user:
            name: "admin"
            permissions:
              - "Overall/Administer"
        - user:
            name: "anonymous"
            permissions:
              - "Overall/Read"

  # Cloud agent configuration
  clouds:
    - docker:
        name: "podman-cloud"
        containerCap: 10
        dockerApi:
          dockerHost:
            uri: "unix:///var/run/podman.sock"
        templates:
          - name: "ceph-seed-agent"
            labelString: "ceph-seed-agent"
            remoteFs: "/home/jenkins"
            mode: EXCLUSIVE
            pullStrategy: PULL_NEVER
            instanceCapStr: "1"
            dockerTemplateBase:
              image: "ceph-jenkins-seed-agent:latest"
              tty: true
              cpuShares: 256
              memorySwap: 256
              memoryLimit: 256
            connector:
              attach:
                user: "jenkins"
          - name: "ceph-build-centos9-agent"
            labelString: "ceph-build-centos9-agent"
            remoteFs: "/home/jenkins"
            mode: EXCLUSIVE
            pullStrategy: PULL_NEVER
            instanceCapStr: "4"
            dockerTemplateBase:
              image: "ceph-jenkins-centos9-agent:latest"
              tty: true
              cpuShares: 4096
              memoryLimit: 16384
              memorySwap: -1
              environment:
                - "ALLOCATED_CPUS=4"
            connector:
              attach:
                user: "jenkins"

security:
  globalJobDslSecurityConfiguration:
    # Allow Job DSL to run without manual script approval.
    useScriptSecurity: false
  scriptApproval:
    # Allow the specific DSL scripts to bypass the sandbox.
    approvedSignatures:
      - "method javaposse.jobdsl.dsl.DslFactory job java.lang.String"
      - "method javaposse.jobdsl.dsl.Job scm(groovy.lang.Closure)"

# Console color configuration
unclassified:
  ansiColorBuildWrapper:
    globalColorMapName: "xterm"

  appearance:
    pipelineGraphView:
      showPipelineGraph: true
      showPipelineStages: true
      showStageDurations: true
      showStageNames: true

# Seeder job
jobs:
  - file: "/var/jenkins_home/seed.groovy"
